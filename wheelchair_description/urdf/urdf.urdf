<?xml version="1.0" encoding="utf-8"?>

<robot name="wheelchair">

  <link name="base_link"/>

  <link name="base_footprint"/>

  <joint name="base_link_footprint" type="fixed">
    <origin xyz="0 0 -0.4" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="base_footprint"/>
  </joint>

  <link name="chassis">
    <inertial>
      <origin xyz="-0.14238 0.06173 -0.10504" rpy="0 0 0" />
      <mass value="9.6593" />
      <inertia ixx="0.35079" ixy="-0.0041582" ixz="4.762E-05" iyy="0.30855" iyz="-1.6408E-05" izz="0.56011" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/base_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="connector" type="fixed">
    <!-- Define your joint properties -->
    <origin xyz="0 0 0" rpy="1.57 0 3.14"/> <!-- This is the original position and orientation of the joint -->
    <!-- Other joint properties -->
    <parent link="base_link"/>
    <child link="chassis"/>
  </joint>

  <link name="left_wheel">
    <inertial>
      <origin xyz="5.5511E-16 -1.9429E-16 -0.016" rpy="0 0 0" />
      <mass value="3.5068" />
      <inertia ixx="0.025596" ixy="-1.1778E-18" ixz="-1.814E-19" iyy="0.025596" iyz="7.7958E-19" izz="0.049823" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/left_wheel.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/left_wheel.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="wheel1" type="continuous">
    <origin xyz="0.21536 -0.23488 0.21222" rpy="0 0 0" />
    <parent link="chassis" />
    <child link="left_wheel" />
    <axis xyz="0 0 1" />
  </joint>

  <link name="right_wheel">
    <inertial>
      <origin xyz="-4.4409E-16 8.3267E-17 -0.016" rpy="0 0 0" />
      <mass value="3.5068" />
      <inertia ixx="0.025596" ixy="1.7094E-18" ixz="3.1551E-19" iyy="0.025596" iyz="3.173E-19" izz="0.049823" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/right_wheel.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/right_wheel.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="wheel2" type="continuous">
    <origin xyz="0.21536 -0.23488 -0.41978" rpy="3.1416 0 3.1416" />
    <parent link="chassis" />
    <child link="right_wheel" />
    <axis xyz="0 0 -1" />
  </joint>

  <link name="depth_camera">
    <inertial>
      <origin xyz="5.1164E-06 -0.012641 0.031883" rpy="0 0 0" />
      <mass value="0.053869" />
      <inertia ixx="5.7339E-06" ixy="2.8393E-11" ixz="5.9589E-09" iyy="3.5154E-05" iyz="1.7675E-07" izz="3.4905E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/depth_camera.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/depth_camera.STL" />
      </geometry>
    </collision>
  </link>

   <link name="camera_link"/>

  <joint name="camera_link_gazebo" type="fixed">
    <origin xyz="-0.39931 0.33074 -0.35378" rpy="1.5708 0 -3.1416" />
    <parent link="chassis" />
    <child link="camera_link" />
    <axis xyz="0 0 0" />
  </joint>

  <joint name="camera" type="fixed">
    <origin xyz="0 0 0" rpy="-1.5708 0 -1.5708" />
    <parent link="camera_link" />
    <child link="depth_camera" />
    <axis xyz="0 0 0" />
  </joint>

  <link name="lidar_link">
    <inertial>
      <origin xyz="-0.0031142 0.017894 -0.0072225" rpy="0 0 0" />
      <mass value="0.13016" />
      <inertia ixx="0.00054372" ixy="6.6921E-05" ixz="-1.1138E-05" iyy="8.3702E-05" iyz="5.9592E-05" izz="0.00057444" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/lidar.STL" />
      </geometry>
      <material name="">
        <color rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://wheelchair_description/meshes/lidar.STL" />
      </geometry>
    </collision>
  </link>

  <joint name="lidar_joint" type="fixed">
    <origin xyz="-0.64132 -0.14701 -0.37178" rpy="1.5714 1.5708 0" />
    <parent link="chassis" />
    <child link="lidar_link" />
    <axis xyz="0 0 0" />
  </joint>

  <link name="laser"/>

  <joint name="lidar_link_geometry" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 3.1416" />
    <parent link="lidar_link" />
    <child link="laser" />
    <axis xyz="0 0 0" />
  </joint>

  <!-- Camera plugin -->
<gazebo reference="camera_link"> <!--XYZ Frame-->
  <sensor name="d435i_realsense_depth" type="depth">
    <update_rate>20</update_rate>
    <camera>
      <horizontal_fov>1.047198</horizontal_fov>
      <image>
        <width>1920</width>
        <height>1080</height>
        <format>R8G8B8</format>
      </image>
      <clip>
        <near>0.05</near>
        <far>30</far>
      </clip>
    </camera>
    <plugin name="kinect_controller" filename="libgazebo_ros_openni_kinect.so">
      <baseline>0.2</baseline>
      <alwaysOn>true</alwaysOn>
      <updateRate>50.0</updateRate>
      <cameraName>d435i_realsense_depth</cameraName>
      <imageTopicName>/camera/color/image_raw</imageTopicName>
      <cameraInfoTopicName>/camera/color/camera_info</cameraInfoTopicName>
      <depthImageTopicName>/camera/depth/image_raw</depthImageTopicName>
      <depthImageInfoTopicName>/camera/depth/camera_info</depthImageInfoTopicName>
      <pointCloudTopicName>/camera/depth/color/points</pointCloudTopicName>
      <frameName>depth_camera</frameName>   <!--ZYX Frame-->
      <pointCloudCutoff>0.5</pointCloudCutoff>
      <pointCloudCutoffMax>3.0</pointCloudCutoffMax>
      <distortionK1>0.00000001</distortionK1>
      <distortionK2>0.00000001</distortionK2>
      <distortionK3>0.00000001</distortionK3>
      <distortionT1>0.00000001</distortionT1>
      <distortionT2>0.00000001</distortionT2>
      <CxPrime>0</CxPrime>
      <Cx>0</Cx>
      <Cy>0</Cy>
      <focalLength>0</focalLength>
      <hackBaseline>0</hackBaseline>
    </plugin>
  </sensor>
</gazebo>

 <gazebo reference="laser">
    <sensor name="head_hokuyo_sensor" type="ray">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>40</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>720</samples>
            <resolution>1</resolution>
            <min_angle>-3.14</min_angle>
            <max_angle>3.14</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.2</min>
          <max>10.1</max>
          <resolution>0.01</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.02</stddev>
        </noise>
      </ray>
      <plugin filename="libgazebo_ros_laser.so" name="gazebo_ros_head_hokuyo_controller">
        <topicName>scan</topicName>
        <frameName>laser</frameName>
      </plugin>
    </sensor>
  </gazebo>

  <gazebo>
    <plugin filename="libgazebo_ros_diff_drive.so" name="differential_drive_controller">
      <alwaysOn>true</alwaysOn>
      <updateRate>50</updateRate>
      <leftJoint>wheel1</leftJoint>
      <rightJoint>wheel2</rightJoint>
      <wheelSeparation>0.643</wheelSeparation>
      <wheelDiameter>0.33</wheelDiameter>
      <torque>20</torque>
      <commandTopic>cmd_vel</commandTopic>
      <odometryTopic>odom</odometryTopic>
      <odometryFrame>odom</odometryFrame>
      <robotBaseFrame>base_footprint</robotBaseFrame>
      <publishTf>0</publishTf>
    </plugin>
  </gazebo>

</robot>
